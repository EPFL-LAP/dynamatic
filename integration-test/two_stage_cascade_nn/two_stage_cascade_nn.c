// hls-fpga-machine-learning `TODO: make imports dynamic at writer level` imports
#include "dynamatic/Integration.h"
#include "stdlib.h"
#include "stdio.h"
#include "nnet_utils/fc.h"

// hls-fpga-machine-learning `TODO: make preicison dynamic at writer level` insert layer precision
#define NB_DEFAULT 16
#define INT_DEFAULT 6
#define FRAC_DEFAULT NB_DEFAULT - INT_DEFAULT

#define NB_ACC  32
#define INT_ACC 12
#define FRAC_ACC NB_ACC - INT_ACC

typedef long dense_accum_t;
typedef int default_t;

#define N_INPUT_1_1 21

// hls-fpga-machine-learning insert dimensions
#define N0_LAYER_2 2

// hls-fpga-machine-learning insert dimensions
#define N1_LAYER_2 32
#define N1_LAYER_5 32
#define N1_LAYER_8 32
#define N1_LAYER_11 3



// BINARY CLASSIFIER WEIGHTS
const default_t w0_1[N0_LAYER_2][N_INPUT_1_1] = {
    94,-62,-493,-240,-372,3,-439,41,365,266,1,-189,-100,71,-380,9,312,-387,75,-194,18,
    195,-16,194,146,388,302,414,-78,97,201,-37,235,111,-12,-211,439,-556,332,548,-33,555
};
const default_t b0_1[N0_LAYER_2] = {
    -27,27
};


// FULL MODEL WEIGHTS
const default_t w1_1[N1_LAYER_2][N_INPUT_1_1] = {
    -295,233,100,266,153,187,0,104,0,-343,-79,12,0,-75,0,175,-993,-1,-71,0,-134,
    85,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    -128,41,235,2,-31,-2,2,143,-43,12,-42,5,1,105,9,-9,-2565,432,270,-167,292,
    132,109,-100,-3,-1,4,0,232,89,-1,-111,87,0,-99,0,195,-822,365,342,0,309,
    14,117,-68,-3,0,-100,0,-10,12,-93,163,-200,0,-14,0,96,-843,-1,-18,-1,313,
    -208,-192,488,-87,-40,73,0,529,9,29,146,-262,0,-84,0,-12,-898,3,20,121,192,
    342,96,-188,-22,-1,-23,0,-87,40,184,96,38,0,98,-1,9,-1543,31,-151,-198,369,
    75,30,82,0,8,-3,-62,-40,-22,-94,35,-5,-10,99,-9,30,2593,-415,-216,175,-245,
    -115,-219,50,-145,11,102,0,-78,26,2,201,-350,0,172,0,0,-1312,138,290,1,698,
    0,32,0,0,0,1,0,0,0,0,7,0,0,-1,0,0,0,0,0,0,0,
    372,285,334,9,0,362,0,-96,271,106,144,200,0,16,1,-223,-2134,353,-62,3,235,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    -214,187,-20,-89,128,-11,0,-25,-6,-310,159,-257,0,-70,-1,135,-1305,225,236,-43,231,
    -114,46,-68,18,-43,-93,205,51,85,78,29,2,246,-50,8,191,-2402,834,571,22,639,
    274,104,79,193,2,137,0,-115,-15,-77,237,-4,0,44,1,210,1302,-2,263,-5,177,
    10,53,-47,-1,-1,10,0,-1,67,-21,182,4,0,174,0,-1,-1353,330,-129,-299,311,
    -299,167,0,0,0,0,0,0,134,0,-11,0,0,0,0,121,0,0,0,0,0,
    139,134,-168,125,177,88,0,-326,13,-198,40,-107,-1,-75,-7,14,2492,-287,162,-132,227,
    -69,282,178,-252,-416,-228,0,-147,6,278,316,-7,-1,95,-6,75,2415,-400,224,385,-272,
    213,-182,-203,19,3,-164,0,-36,3,73,3,-86,0,38,0,0,5,0,5,1,3,
    // ***********
    200,-128,147,200,-43,-83,0,-24,53,-118,-117,120,0,-17,-1,10,-655,0,-95,-203,-92,
    -135,-13,-63,0,-2,-64,0,-73,49,199,12,5,0,148,6,-122,-1723,746,-79,102,584,
    176,-91,268,-24,-73,-100,0,1,-6,181,254,-279,0,21,0,-73,-1832,70,-52,-236,375,
    180,336,411,2,3,167,0,314,71,-86,-5,10,0,149,0,3,-1246,1,-221,-281,104,
    222,-21,-139,222,-41,-56,0,-107,-230,134,-285,264,0,-161,0,-152,-1804,570,400,197,498,
    38,313,-267,-5,29,-257,0,-15,-4,-50,-79,81,0,-44,6,-1,-2810,216,-99,-80,394,
    140,0,-26,-2,-2,8,0,-4,-6,166,83,5,0,-13,0,196,-1504,0,-213,1,-187,
    -25,219,0,0,0,-75,0,0,0,84,2,0,0,-5,0,-5,0,0,0,1,-4,
    -167,-265,-124,-197,110,103,0,-42,-134,-141,-155,7,0,-63,0,284,-1656,515,288,-295,710,
    313,272,9,0,38,15,0,-91,74,-217,323,-121,0,-120,0,62,-1154,425,207,-146,-102,
    -71,129,4,0,3,-2,0,-49,282,297,-5,-5,0,0,-6,44,2518,-337,-229,513,-74,
    257,114,208,-1,47,-104,0,-22,103,23,227,2,0,-45,1,-88,-1971,27,-154,-230,-146
};
const default_t b1_1[N1_LAYER_2] = {
    14,-70,129,7,47,120,39,221,75,-16,16,-45,104,76,17,53,12,-35,131,5,5,97,0,12,2,46,79,-87,177,31,247,22
};
const default_t w1_3[N1_LAYER_5][N1_LAYER_2] = {
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    91,-72,144,-47,235,-6,-73,-423,142,43,327,0,151,19,-23,66,45,-128,-330,138,3,211,31,190,5,107,133,-45,377,195,-69,32,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    92,0,176,-149,167,140,-98,-282,206,0,173,0,299,351,-59,155,-1,-111,-293,213,3,9,358,196,-34,70,201,0,101,2,-243,15,
    313,0,611,-11,-16,373,0,-303,13,0,14,0,118,461,-296,131,39,-263,-209,-70,69,376,154,22,-1,483,372,237,67,4,-153,393,
    6,0,392,106,0,299,-112,-152,-14,0,136,0,2,160,-21,10,-6,-189,-288,-65,40,48,427,253,38,125,141,0,7,-80,-140,213,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    7,50,426,121,268,30,314,-337,189,-92,18,0,-59,144,-184,12,-4,-304,-178,-196,133,294,360,51,270,108,28,0,46,236,-419,96,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    -100,0,-161,45,14,-176,2,542,16,0,-10,0,17,-182,11,-10,5,410,433,248,-21,-100,-141,-14,5,-222,112,3,4,81,503,-58,
    8,0,63,101,0,67,191,-398,-7,0,331,0,4,464,-7,4,0,-270,-244,211,4,275,146,63,257,79,260,-23,117,0,-457,187,
    2,114,148,145,-2,-12,8,-405,114,0,196,0,136,344,175,252,0,-214,-427,84,36,215,11,2,192,66,20,-2,190,215,-210,96,
    349,-133,134,108,23,-40,325,-491,67,0,212,0,-2,629,-170,13,53,-193,-16,21,3,513,210,-3,259,420,46,-116,436,56,-267,358,
    28,0,502,-26,-1,329,83,-334,-10,0,170,0,253,391,237,-93,-6,-305,-418,-57,198,80,105,118,252,282,-5,-2,121,-170,-305,155,
    22,0,438,-178,-25,917,-130,0,-75,0,261,0,0,-5,-201,1,-2,-266,-8,-29,236,8,193,304,37,127,49,0,0,2,-4,157,
    1,119,196,-54,-2,-2,156,-506,102,-92,138,0,236,644,-89,298,-68,-383,-304,105,272,382,344,4,276,303,40,-2,513,289,-512,178,
    312,0,602,-19,6,-31,312,-599,99,205,352,0,277,186,-240,72,56,-445,-445,127,143,45,-27,11,128,319,251,152,399,127,-295,133,
    6,0,244,36,-1,119,79,-402,82,0,297,0,104,82,101,1,0,-157,-232,148,8,136,2,125,-28,328,19,0,283,167,-239,-5,
    79,0,312,218,257,322,62,-538,214,-41,26,0,130,431,-64,333,-1,-106,-174,-127,52,597,135,-37,65,97,155,-2,608,300,-98,-44,
    198,0,633,15,-1,160,78,-398,346,0,76,0,139,622,-15,262,-2,-397,-247,0,44,475,24,179,388,193,8,-3,390,-51,-191,447,
    168,0,244,17,0,-21,122,-316,361,0,289,0,-2,589,-74,192,-2,-139,-109,25,23,324,137,-73,206,259,178,17,338,136,-129,10,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    -92,0,-136,-70,96,-185,-79,555,14,0,-9,0,19,-146,310,-2,4,411,505,181,-10,-80,-82,62,5,-78,-18,64,3,-14,385,-60,
    -3,0,-119,-23,4,-282,258,182,34,0,-177,0,1,8,303,17,2,369,251,12,-6,-5,-55,-59,60,-124,136,0,3,-52,124,-100,
    226,-32,245,283,42,-99,317,-423,580,-112,307,0,108,960,4,141,-31,-151,-302,52,69,634,282,-85,458,447,-112,-60,575,249,-358,-26,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
};
const default_t b1_3[N1_LAYER_5] = {
    -41,7,-36,-12,20,58,10,-46,3,-29,-17,-24,-17,-12,-42,250,-7,43,19,30,-27,-2,15,-26,82,45,-29,-3,226,164,-25,-45
};
const default_t w1_5[N1_LAYER_8][N1_LAYER_5] = {
    0,0,0,0,0,406,-4,0,4,0,0,0,0,0,0,-13,30,389,514,291,-231,592,224,36,494,440,584,0,-92,98,728,0,
    0,-15,0,0,-74,-282,-105,0,-205,0,0,0,0,0,0,389,133,-23,-98,-136,-142,-177,-301,-159,-91,-164,-181,0,357,191,-325,0,
    0,240,0,0,0,-4,0,0,0,0,0,0,0,0,0,0,254,375,411,0,0,61,1,105,483,461,409,0,-1,0,247,0,
    0,214,0,0,46,147,0,0,243,0,0,0,0,0,0,0,208,215,398,25,2,434,412,29,384,339,448,0,-1,7,585,0,
    0,83,0,0,36,626,176,0,379,0,0,0,0,0,0,-478,160,237,7,323,144,466,387,61,420,22,313,0,-84,-31,208,0,
    0,2,0,0,6,146,17,0,33,0,0,0,0,0,0,-135,212,180,352,29,14,395,216,1,10,25,41,0,-123,-201,407,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,-28,-4,0,-51,0,0,0,0,0,0,147,-53,-15,-147,-5,-45,-206,-238,0,-11,-70,-37,0,152,7,-195,0,
    0,0,0,0,-1,-29,-6,0,-4,0,0,0,0,0,0,100,-2,-79,-3,-2,-197,2,-221,0,0,-3,0,0,13,22,0,0,
    0,46,0,0,-98,-219,-91,0,-284,0,0,0,0,0,0,441,-186,-78,-179,-211,-112,-391,-422,-11,-83,-188,-220,0,396,207,-220,0,
    0,5,0,0,-28,-214,-94,0,-269,0,0,0,0,0,0,430,-243,-28,-240,-190,-123,-155,-595,-17,-123,-137,-176,0,394,227,-194,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,317,0,0,198,430,91,0,373,0,0,0,0,0,0,-257,20,315,167,341,-56,349,333,-24,436,218,410,0,-119,-8,616,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,165,0,0,48,490,382,0,165,0,0,0,0,0,0,-125,173,92,-5,425,224,82,152,245,20,213,21,0,-112,-264,230,0,
    0,-73,0,0,-43,-188,-36,0,-190,0,0,0,0,0,0,488,-94,72,-194,-167,-67,-80,-608,-113,-137,-273,-249,0,580,234,-88,0,
    0,290,0,0,2,191,198,0,49,0,0,0,0,0,0,-349,366,355,360,399,0,81,327,1,405,284,196,0,-124,-185,132,0,
    0,-9,0,0,-200,-159,-82,0,-118,0,0,0,0,0,0,324,17,-195,-148,-86,-164,-163,-557,-11,0,-206,-81,0,445,153,72,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
    0,199,0,0,219,620,523,0,384,0,0,0,0,0,0,-97,31,61,316,236,202,245,513,1,265,302,238,0,-271,-24,8,0,
    0,0,0,0,1,-6,-1,0,1,0,0,0,0,0,0,0,0,1,0,0,-3,0,0,0,2,-3,2,0,0,1,344,0,
    0,248,0,0,442,431,722,0,404,0,0,0,0,0,0,-214,333,-82,372,370,482,76,302,284,353,406,81,0,-335,-108,-97,0,
    0,348,0,0,318,268,1,0,219,0,0,0,0,0,0,-309,356,213,326,67,-2,95,176,265,12,49,141,0,-162,-147,451,0,
    0,63,0,0,216,189,0,0,198,0,0,0,0,0,0,-173,419,170,474,1,-4,469,167,333,550,610,624,0,-251,0,391,0,
    0,96,0,0,101,324,368,0,139,0,0,0,0,0,0,-19,35,-127,79,441,1054,70,572,232,-7,326,9,0,-2,-367,-46,0,
    0,20,0,0,150,22,-1,0,123,0,0,0,0,0,0,1,89,178,550,-1,-1,250,391,0,684,486,607,0,0,41,753,0
};
const default_t b1_5[N1_LAYER_8] = {
    34,313,81,20,-27,-48,-13,220,54,368,318,-20,11,-16,-19,-26,-2,-19,131,-22,77,-18,-3,-18,-19,-53,61,-34,-38,53,18,42
};
const default_t w1_7[N1_LAYER_11][N1_LAYER_8] = {
    -719,444,-276,-830,-162,-362,0,332,4,637,505,0,-515,0,0,0,0,76,472,-511,182,0,0,0,0,-293,-413,65,-144,-364,88,-963,
    127,168,242,31,-312,-271,0,91,260,198,135,0,33,0,0,0,0,-266,68,-370,212,0,0,0,0,-378,2,-543,-29,153,-729,-55,
    305,-728,328,268,566,132,0,-336,-46,-785,-882,0,580,0,0,0,0,583,-752,123,-550,0,0,0,0,510,-26,626,414,519,635,40
};
const default_t b1_7[N1_LAYER_11] = {
    -43,22,-13
};

// *****************************
// NETWORK INSTANTIATION
// ****************************************
void two_stage_cascade_nn(
    default_t input_0, 
    default_t input_1, 
    default_t input_2, 
    default_t input_3, 
    default_t input_4, 
    default_t input_5, 
    default_t input_6, 
    default_t input_7, 
    default_t input_8, 
    default_t input_9, 
    default_t input_10, 
    default_t input_11, 
    default_t input_12, 
    default_t input_13, 
    default_t input_14, 
    default_t input_15, 
    default_t input_16, 
    default_t input_17, 
    default_t input_18, 
    default_t input_19, 
    default_t input_20, 
    default_t out8_0[1],
    default_t out8_1[1],
    default_t out8_2[1]
    ) {
    // hls-fpga-machine-learning intermediate stores
    default_t tmp_input[N_INPUT_1_1];
    tmp_input[0] = input_0;
    tmp_input[1] = input_1;
    tmp_input[2] = input_2;
    tmp_input[3] = input_3;
    tmp_input[4] = input_4;
    tmp_input[5] = input_5;
    tmp_input[6] = input_6;
    tmp_input[7] = input_7;
    tmp_input[8] = input_8;
    tmp_input[9] = input_9;
    tmp_input[10] = input_10;
    tmp_input[11] = input_11;
    tmp_input[12] = input_12;
    tmp_input[13] = input_13;
    tmp_input[14] = input_14;
    tmp_input[15] = input_15;
    tmp_input[16] = input_16;
    tmp_input[17] = input_17;
    tmp_input[18] = input_18;
    tmp_input[19] = input_19;
    tmp_input[20] = input_20;

    default_t out0_1[N0_LAYER_2];
    default_t out0_2[N0_LAYER_2];

    // hls-fpga-machine-learning insert layers
    dense_accum_t acc1;
    default_t tmp1;
    DENSE_LAYER(tmp_input, out0_1, N_INPUT_1_1, N0_LAYER_2, w0_1, b0_1, acc1, tmp1);
    default_t tmp2;
    ARGMAX(out0_1, out0_2, N0_LAYER_2, tmp2);

    if (out0_2[1] == (1 << (FRAC_DEFAULT))) {
        out8_0[0] = 0;
        out8_1[0] = 0;
        out8_2[0] = out0_2[1];
    } else {
        default_t out1_1[N1_LAYER_2];
        default_t out1_3[N1_LAYER_5];
        default_t out1_5[N1_LAYER_8];
        default_t out1_7[N1_LAYER_11];
        default_t out1_8[N1_LAYER_11];
    
        // hls-fpga-machine-learning insert layers
        dense_accum_t acc1;
        default_t tmp1;
        DENSE_RELU_LAYER(tmp_input, out1_1, N_INPUT_1_1, N1_LAYER_2, w1_1, b1_1, acc1, tmp1);
        dense_accum_t acc3;
        default_t tmp3;
        DENSE_RELU_LAYER(out1_1, out1_3, N1_LAYER_2, N1_LAYER_5, w1_3, b1_3, acc3, tmp3);
        dense_accum_t acc5;
        default_t tmp5;
        DENSE_RELU_LAYER(out1_3, out1_5, N1_LAYER_5, N1_LAYER_8, w1_5, b1_5, acc5, tmp5);
        dense_accum_t acc7;
        default_t tmp7;
        DENSE_LAYER(out1_5, out1_7, N1_LAYER_8, N1_LAYER_11, w1_7, b1_7, acc7, tmp7);
        default_t tmp8;
        ARGMAX(out1_7, out1_8, N1_LAYER_11, tmp8);
    
        // hls-fpga-machine-learning write outputs
        out8_0[0] = out1_8[0];
        out8_1[0] = out1_8[1];
        out8_2[0] = out1_8[2];
    }

}

int main(void) {
    srand(13);

    // hls-fpga-machine-learning input init
    srand(13);
    // -------------------------- Short Path
    // default_t input_0  = 1024;
    // default_t input_1  = 1024;
    // default_t input_2  = 1024;
    // default_t input_3  = 1024;
    // default_t input_4  = 1024;
    // default_t input_5  = 1024;
    // default_t input_6  = 1024;
    // default_t input_7  = 1024;
    // default_t input_8  = 1024;
    // default_t input_9  = 1024;
    // default_t input_10 = 1024;
    // default_t input_11 = 1024;
    // default_t input_12 = 1024;
    // default_t input_13 = 1024;
    // default_t input_14 = 1024;
    // default_t input_15 = 1024;
    // default_t input_16 = 1024;
    // default_t input_17 = 1024;
    // default_t input_18 = 1024;
    // default_t input_19 = 1024;
    // default_t input_20 = 1024;

    // -------------------------- Long Path
    //     [624.64       0.         0.         0.         0.         0.
    //     0.         0.      1024.         0.         0.         0.
    //     0.         0.         0.         0.         6.0416    20.48
    //    83.968     98.304     87.27552]
    default_t input_0  = 624;
    default_t input_1  = 0;
    default_t input_2  = 0;
    default_t input_3  = 0;
    default_t input_4  = 0;
    default_t input_5  = 0;
    default_t input_6  = 0;
    default_t input_7  = 0;
    default_t input_8  = 1024;
    default_t input_9  = 0;
    default_t input_10 = 0;
    default_t input_11 = 0;
    default_t input_12 = 0;
    default_t input_13 = 0;
    default_t input_14 = 0;
    default_t input_15 = 0;
    default_t input_16 = 6;
    default_t input_17 = 20;
    default_t input_18 = 84;
    default_t input_19 = 98;
    default_t input_20 = 87;

    default_t out8_0[1];
    default_t out8_1[1];
    default_t out8_2[1];

    CALL_KERNEL(
        two_stage_cascade_nn,
        input_0, 
        input_1, 
        input_2, 
        input_3, 
        input_4, 
        input_5, 
        input_6, 
        input_7, 
        input_8, 
        input_9, 
        input_10, 
        input_11, 
        input_12, 
        input_13, 
        input_14, 
        input_15, 
        input_16, 
        input_17, 
        input_18, 
        input_19, 
        input_20, 
        out8_0,
        out8_1,
        out8_2
    );
    return 0;
    
}