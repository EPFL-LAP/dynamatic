import json
import re
import argparse


def parse_nuxmv(json_file, nuxmv_file):
  with open(json_file, 'r') as f:
    json_data = json.load(f)

  with open(nuxmv_file, 'r') as f:
    nuXmv_lines = f.readlines()

  check_pattern = r"\b(True|False|Unchecked)\b"

  updated = False
  for obj in json_data:
    obj_id = obj.get("id")
    pattern = fr"p{obj_id}\]"
    for line in nuXmv_lines:
      if re.search(pattern, line):
        status_match = re.search(check_pattern, line)
        if status_match and obj["check"] != status_match.group(1):
          obj["check"] = status_match.group(1)
          updated = True
          break

  if updated:
    with open(json_file, 'w') as f:
      json.dump(json_data, f, indent=2)


if __name__ == "__main__":
  parser = argparse.ArgumentParser(
      description="Update properties database based on the results of nuXmv.")
  parser.add_argument("json_file", help="Path to the JSON file to update.")
  parser.add_argument(
      "nuxmv_file", help="Path to the file generated by nuXmv.")
  args = parser.parse_args()

  parse_nuxmv(args.json_file, args.nuxmv_file)
