# Floating Point Units

This document explains the integration of floating points units in Dynamatic.


## Overview

Floating point units are special units that compute operations on floating point numbers. Dynamatic does not have a floating point units generator but it uses units from other generators. The current version of Dynamatic supports floating point units from two generators:

- [FloPoCo](https://flopoco.org/)
- [Vivado](https://www.amd.com/en/products/software/adaptive-socs-and-fpgas/vivado.html)

### How to specify the unit generator?

In order to specify which units to use, the user can use the following command when executing dynamatic:

`set-fp-units-generator generator_name`

For instance, to set vivado as the units generator the command would look as follows:

`set-fp-units-generator vivado`

The default units generator is FloPoCo.

### Using Vivado's floating point units

#### IPs integration

Make sure you have **compatible versions** of Vivado and ModelSim. The following link contains a list of compatible versions:
https://www.xilinx.com/support/answers/68324.html

Since Vivado generates floating point units based on its own IPs, the user has to download the vivado IPs separately. In order to generate them, in Vivado, select Tools -> Compile simulation libraries -> ModelSim simulator, and set the path to where your ModelSim is.  Please refer to [this link](https://adaptivesupport.amd.com/s/question/0D52E00007G0iKDSAZ/simulating-on-modelsim-with-vivado?language=en_US) for more information. 


Once the user has downloaded the Vivado IPs, the user has to update the path of these libraries for modelsim simulation by updating the path `/opt/modelsim_lib/` in this [modelsim.ini](https://github.com/EPFL-LAP/dynamatic/blob/main/tools/hls-verifier/resources/modelsim.ini).

#### Extra setup

Additionally, the user has to provide the path to the Vivado installation folder. The user can use the following command:

`set-vivado-path vivado_path`

The default value for the vivado path is `/tools/Xilinx/Vivado/2019.1/`. This information is essentially to correctly integrate necessary simulation files of Vivado.


### RTL and timing information structure

We extract these units offline and we have saved them in the folders [flopoco](https://github.com/EPFL-LAP/dynamatic/tree/main/data/vhdl/arith/flopoco/) and [vivado](https://github.com/EPFL-LAP/dynamatic/tree/main/data/vhdl/arith/vivado). 

In order to select the correct generated units, we have two JSON files containing information related to the RTLs generated by the two generators: [rtl-config-vhdl-flopoco.json](https://github.com/EPFL-LAP/dynamatic/blob/main/data/rtl-config-vhdl-flopoco.json) and [rtl-config-vhdl-vivado.json](https://github.com/EPFL-LAP/dynamatic/blob/main/data/rtl-config-vhdl-vivado.json). 

Additionally, we also need timing information for each unit generated by the two generators. These are stored in the two JSON files [components-flopoco.json](https://github.com/EPFL-LAP/dynamatic/blob/main/data/components-flopoco.json) and [components-vivado.json](https://github.com/EPFL-LAP/dynamatic/blob/main/data/components-vivado.json). For more information related to timing information, please refer to [this markdown](https://github.com/EPFL-LAP/dynamatic/blob/main/docs/Specs/TimingInformation.md).




