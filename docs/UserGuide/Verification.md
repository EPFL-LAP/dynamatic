[Documentation Table of Contents](../README.md)

# Verifying the Generated Design
## C-RTL Cosimulation  

To verify the correctness of your circuit after generating it with Dynamatic, the easiest way is to run a simulation.   
Dynamatic has a cosimulation framework that allows the user to write a testbench in C code. To take advantage of this, you must ensure that you:   
- Includ the `dynamatic/Integration.h` header
- Create a main function where your test inputs will be instantiated
- Make a function call to the function under test in the main function using the following syntax: `CALL_KERNEL(<func_name>, <arg1>, <arg2>, ..., <argN>);` . The values of the arguments passed to the function (i.e., `<arg1>, <arg2>, ..., <argN>`) will be used internally by our cosimulation framework as test stimuli.  
> [!TIP]
> The variables declared in the `main` function must have the same names and data types as the function parameters of your function under test  

The `simulate` command runs a co-simulation of the program in C and the HDL implementation generated by Dynamatic on the same inputs.  

### Directory Structure of Cosimulation Result 
#### 1. C_SRC  
Contains a copy of the C source file under test as well as any included header files. These will be used to compile and run the C program using a regular C compiler.

#### 2. HDL_SRC  
Contains a clone of the HDL directory created by the `write-hdl` command plus the addition of a testbench file that passes the inputs from the `main` function.  

#### 3. INPUT_VECTORS  
Contains a list of `.dat` files for each input declared in the `main` function. These are passed to the C and HDL files during the co-simulation. 

#### 4. C_OUT  
Contains the results of compiling and running the C program stored as `.dat` files for every output.

#### 5. HDL_OUT  
Contains the results of running the HDL simulation of the program in Modelsim/Questa stored as `.dat` files for every output.

#### 6. HLS_VERIFY  
Contains  
- Modelsim information 
    - default settings 
    - library information to configure the simulator
- a script to compile and run the HDL simulation.
- a transcript of all commands run during the simulation. 
- testbench information 
    - optimization data
    - temporary compilation data
    - temporary message logs
    - library metadata
    - library hierarchy and elaboration logic  
    - dependency listing
- the results of the waveform transitions that occured during the simulation, stored in a `vsim.wlf` file.

#### 7. report.txt  
The report file gives information on the HDL simulation in Modelsim/Questa as well as some runtime and clock cycle information. If simulation fails, this file will also contain error logs to helo the user understand the cause of failure.  

Dynamatic compares the files in `C_OUT` and `HDL_OUT` to determine whether the HDL code generated does what the C program was intended to do.